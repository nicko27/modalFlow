
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentation ModalFlow</title>
    <style>
        :root {
            --primary-color: #6366f1; /* Indigo */
            --secondary-color: #ec4899; /* Pink */
            --text-color: #1f2937;
            --bg-color: #ffffff;
            --code-bg: #f3f4f6;
            --border-color: #e5e7eb;
            --nav-width: 260px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background: var(--bg-color);
            padding: 2rem;
        }

        .container {
            max-width: 1300px;
            margin: 0 auto;
        }

        h1, h2, h3, h4 {
            margin: 1.5rem 0 1rem;
            color: var(--primary-color);
        }

        h1 {
            font-size: 2.8rem;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 0.5rem;
            margin-top: 0;
        }

        h2 {
            font-size: 2rem;
            margin-top: 3rem;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 0.4rem;
        }

        h3 {
            font-size: 1.5rem;
            margin-top: 2.5rem;
            color: var(--secondary-color);
        }
         h4 {
            font-size: 1.2rem;
            margin-top: 2rem;
            color: var(--text-color);
            font-weight: 600;
        }

        p, ul, ol {
            margin-bottom: 1rem;
        }

        ul, ol {
            padding-left: 2rem;
        }

        code {
            background: var(--code-bg);
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9em;
        }

        pre {
            background: var(--code-bg);
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto;
            margin: 1rem 0;
            font-size: 0.9em;
        }

        pre code {
            background: none;
            padding: 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
        }

        th, td {
            padding: 0.8rem 1rem;
            text-align: left;
            border: 1px solid var(--border-color);
            vertical-align: top;
        }

        th {
            background: #f9fafb;
            font-weight: 600;
        }

        .example {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin: 1.5rem 0;
            background-color: #ffffff;
        }

        .example-preview {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
         .example-preview button {
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            color: white;
            cursor: pointer;
            font-size: 0.9em;
         }
         .example-preview .btn-primary { background-color: var(--primary-color); }
         .example-preview .btn-secondary { background-color: #64748b; }
         .example-preview button:hover { opacity: 0.85; }


        .example-code {
            padding: 1rem;
            background: var(--code-bg);
            border-radius: 0 0 8px 8px;
        }

        .nav {
            position: fixed;
            top: 1rem;
            bottom: 1rem;
            left: 1rem;
            width: var(--nav-width);
            overflow-y: auto;
            padding: 1.5rem;
            background: var(--bg-color);
            border-right: 1px solid var(--border-color);
            font-size: 0.9em;
            box-shadow: 2px 0 5px rgba(0,0,0,0.05);
            border-radius: 8px;
        }

        .nav h3 {
            margin-top: 0;
            font-size: 1.1em;
        }

        .nav ul {
            list-style: none;
            padding: 0;
        }
         .nav > ul > li {
             margin-bottom: 0.8rem;
             font-weight: 500;
         }

         .nav ul ul {
             padding-left: 1rem;
             margin-top: 0.3rem;
             font-weight: normal;
         }
         .nav ul ul li {
             margin-bottom: 0.3rem;
         }


        .nav a {
            color: var(--primary-color);
            text-decoration: none;
            display: block;
            padding: 0.3rem 0.5rem;
            border-radius: 4px;
            transition: background-color 0.2s ease, color 0.2s ease;
        }

        .nav a:hover, .nav a.active {
            text-decoration: none;
            background-color: #eef2ff; /* indigo-50 */
            color: #3730a3; /* indigo-800 */
        }

        .content {
            margin-left: calc(var(--nav-width) + 2rem);
        }

        .info-block, .warning-block {
            padding: 1rem 1.5rem;
            margin: 1.5rem 0;
            border-radius: 4px;
            border-left-width: 5px;
            border-left-style: solid;
        }

        .info-block {
            background-color: #eef2ff;
            border-color: var(--primary-color);
            color: #3730a3;
        }

        .warning-block {
            background-color: #fffbeb;
            border-color: #facc15;
            color: #713f12;
        }

        .attr {
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9em;
            color: #db2777; /* Pink */
        }
        .type {
            font-style: italic;
            color: #7f8c8d;
        }
        .default {
             font-family: 'Courier New', Courier, monospace;
             color: #16a34a; /* Green */
             font-size: 0.9em;
        }

        /* Style pour les groupes de formulaire dans les exemples */
         .form-group {
            margin-bottom: 1rem;
         }
         .form-group label {
            display: block;
            margin-bottom: 0.3rem;
            font-weight: 500;
         }
         .form-group input[type="text"],
         .form-group input[type="email"],
         .form-group input[type="number"] {
            width: 100%;
            padding: 0.6rem;
            border: 1px solid var(--border-color);
            border-radius: 4px;
         }
         .error-message {
            color: #ef4444; /* red-500 */
            font-size: 0.85em;
            margin-top: 0.2rem;
         }
         input.invalid {
             border-color: #ef4444;
         }


        @media (max-width: 1024px) {
            .nav {
                display: none;
            }
            .content {
                margin-left: 0;
            }
        }
        @media (max-width: 600px) {
            body {
                padding: 1rem;
            }
            h1 { font-size: 2rem; }
            h2 { font-size: 1.6rem; }
            h3 { font-size: 1.2rem; }
            .container {
                 padding: 1rem;
            }
             .example-preview, .example-code {
                 padding: 1rem;
            }
        }
    </style>
    <!-- Assurez-vous d'inclure modalFlow.css -->
    <link rel="stylesheet" href="../src/modalFlow.css">
</head>
<body>
    <div class="container">
        <nav class="nav">
            <h3>Table des matières</h3>
            <ul>
                <li><a href="#introduction">Introduction</a></li>
                <li><a href="#installation">Installation</a></li>
                <li><a href="#initialisation">Initialisation</a></li>
                <li><a href="#creation-modales">Création de Modales</a>
                     <ul>
                         <li><a href="#methode-create"><code>create()</code></a></li>
                         <li><a href="#methode-createandopen"><code>createAndOpen()</code></a></li>
                         <li><a href="#options-creation">Options de Création</a></li>
                    </ul>
                </li>
                 <li><a href="#gestion-modales">Gestion des Modales</a>
                    <ul>
                         <li><a href="#methode-open"><code>open()</code></a></li>
                         <li><a href="#methode-close"><code>close()</code> / <code>closeModal()</code></a></li>
                         <li><a href="#methode-update"><code>update()</code></a></li>
                         <li><a href="#methode-destroy"><code>destroy()</code></a></li>
                    </ul>
                </li>
                <li><a href="#personnalisation-affichage">Personnalisation Affichage</a>
                     <ul>
                        <li><a href="#personnalisation-header">En-tête (Header)</a></li>
                        <li><a href="#personnalisation-footer">Pied de page (Footer) / Boutons</a></li>
                        <li><a href="#themes">Thèmes</a></li>
                        <li><a href="#css">CSS</a></li>
                    </ul>
                </li>
                <li><a href="#fonctionnalites-integrees">Fonctionnalités Intégrées</a>
                    <ul>
                        <li><a href="#drag-drop">Drag & Drop</a></li>
                        <li><a href="#redimensionnement">Redimensionnement</a></li>
                        <li><a href="#validation-formulaires">Validation de Formulaires</a></li>
                        <li><a href="#chargement-ajax">Chargement AJAX</a></li>
                    </ul>
                </li>
                <li><a href="#evenements">Événements</a></li>
                <li><a href="#reponses-serveur">Gestion Réponses Serveur</a></li>
                <li><a href="#exemples-interactifs">Exemples Interactifs</a></li>
            </ul>
        </nav>

        <div class="content">
            <h1>Documentation ModalFlow</h1>

            <section id="introduction">
                <h2>Introduction</h2>
                <p>ModalFlow est une bibliothèque JavaScript conçue pour simplifier la création et la gestion de fenêtres modales (popups) interactives et modernes dans vos applications web.</p>
                <p>Elle intègre des fonctionnalités avancées directement dans son cœur, éliminant le besoin de multiples plugins externes pour des besoins courants :</p>
                <ul>
                    <li>Création facile de modales avec contenu HTML ou chargé via AJAX.</li>
                    <li>Déplacement des modales par glisser-déposer (Drag & Drop).</li>
                    <li>Redimensionnement interactif des modales.</li>
                    <li>Validation intégrée des formulaires inclus dans les modales.</li>
                    <li>Gestion des confirmations utilisateur et des callbacks.</li>
                    <li>Configuration flexible de l'apparence (thèmes, dimensions) et du comportement (fermeture, animations).</li>
                    <li>Système d'événements pour réagir aux actions sur les modales.</li>
                </ul>
            </section>

            <section id="installation">
                <h2>Installation</h2>
                <p>Pour utiliser ModalFlow, incluez son fichier CSS pour le style et son fichier JavaScript pour la logique.</p>
                 <pre><code>&lt;!-- Feuille de style de ModalFlow --&gt;
&lt;link rel="stylesheet" href="path/to/modalFlow.css"&gt;

&lt;!-- Script de ModalFlow --&gt;
&lt;script src="path/to/modalFlow.js"&gt;&lt;/script&gt;</code></pre>
                 <div class="info-block">
                    Le script <code>modalFlow.js</code> expose la classe <code>ModalFlow</code> globalement (<code>window.ModalFlow</code>) ou peut être utilisé avec des systèmes de modules (CommonJS, AMD).
                </div>
            </section>

             <section id="initialisation">
                <h2>Initialisation</h2>
                <p>Créez une instance de <code>ModalFlow</code> pour commencer. Vous pouvez passer un objet de configuration au constructeur pour définir des options globales qui s'appliqueront à toutes les modales créées par cette instance (sauf si surchargées lors de la création d'une modale spécifique).</p>
                 <pre><code class="language-javascript">// Initialisation simple (options par défaut)
const modal = new ModalFlow();

// Initialisation avec configuration personnalisée
const customModal = new ModalFlow({
    theme: 'dark',             // Thème sombre par défaut
    closeOnOverlayClick: false, // Empêche la fermeture via clic sur l'overlay
    draggable: true,           // Rend toutes les modales déplaçables par défaut
    resizable: true,           // Rend toutes les modales redimensionnables par défaut
    animation: true,           // Active les animations
    validateLive: true,        // Active la validation en temps réel des formulaires
    // ... autres options globales ...
});</code></pre>

                <h3>Options de Configuration (Constructeur)</h3>
                <table>
                    <thead>
                        <tr><th>Option</th><th>Type</th><th>Défaut</th><th>Description</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><code class="attr">theme</code></td><td class="type">string</td><td><code class="default">'light'</code></td><td>Thème visuel global ('light' ou 'dark').</td></tr>
                        <tr><td><code class="attr">animation</code></td><td class="type">boolean</td><td><code class="default">true</code></td><td>Activer/désactiver les animations d'ouverture/fermeture.</td></tr>
                        <tr><td><code class="attr">closeOnEscape</code></td><td class="type">boolean</td><td><code class="default">true</code></td><td>Permettre la fermeture avec la touche Échap.</td></tr>
                        <tr><td><code class="attr">closeOnOverlayClick</code></td><td class="type">boolean</td><td><code class="default">true</code></td><td>Permettre la fermeture en cliquant sur l'overlay (fond semi-transparent).</td></tr>
                        <tr><td><code class="attr">showCloseButton</code></td><td class="type">boolean</td><td><code class="default">true</code></td><td>Afficher le bouton (X) de fermeture dans l'en-tête par défaut.</td></tr>
                        <tr><td><code class="attr">maxWidth</code></td><td class="type">string</td><td><code class="default">'800px'</code></td><td>Largeur maximale pour les modales.</td></tr>
                        <tr><td><code class="attr">width</code></td><td class="type">string</td><td><code class="default">'90%'</code></td><td>Largeur par défaut des modales (peut être surchargée par modale).</td></tr>
                        <tr><td><code class="attr">height</code></td><td class="type">string</td><td><code class="default">'auto'</code></td><td>Hauteur par défaut des modales (peut être surchargée par modale).</td></tr>
                        <tr><td><code class="attr">position</code></td><td class="type">string</td><td><code class="default">'center'</code></td><td>Position verticale par défaut ('center', 'top', 'bottom').</td></tr>
                        <tr><td><code class="attr">overlayOpacity</code></td><td class="type">number</td><td><code class="default">0.5</code></td><td>Opacité de l'overlay (0 à 1).</td></tr>
                        <tr><td><code class="attr">zIndex</code></td><td class="type">number</td><td><code class="default">1000</code></td><td>Index z de base pour l'overlay et les modales.</td></tr>
                        <tr><td><code class="attr">draggable</code></td><td class="type">boolean</td><td><code class="default">false</code></td><td>Rendre les modales déplaçables par défaut.</td></tr>
                        <tr><td><code class="attr">dragHandle</code></td><td class="type">string</td><td><code class="default">'.modal-flow-header'</code></td><td>Sélecteur CSS pour la zone de préhension du drag & drop.</td></tr>
                        <tr><td><code class="attr">resizable</code></td><td class="type">boolean</td><td><code class="default">false</code></td><td>Rendre les modales redimensionnables par défaut.</td></tr>
                        <tr><td><code class="attr">minWidth</code></td><td class="type">number</td><td><code class="default">200</code></td><td>Largeur minimale lors du redimensionnement.</td></tr>
                        <tr><td><code class="attr">minHeight</code></td><td class="type">number</td><td><code class="default">150</code></td><td>Hauteur minimale lors du redimensionnement.</td></tr>
                        <tr><td><code class="attr">handles</code></td><td class="type">Array&lt;string&gt;</td><td><code class="default">['se', 'sw', 'ne', 'nw']</code></td><td>Poignées de redimensionnement actives (sud-est, sud-ouest, nord-est, nord-ouest).</td></tr>
                        <tr><td><code class="attr">keepAspectRatio</code></td><td class="type">boolean</td><td><code class="default">false</code></td><td>Conserver les proportions lors du redimensionnement.</td></tr>
                        <tr><td><code class="attr">validateLive</code></td><td class="type">boolean</td><td><code class="default">true</code></td><td>Activer la validation des formulaires en temps réel (pendant la saisie).</td></tr>
                        <tr><td><code class="attr">validateErrorClass</code></td><td class="type">string</td><td><code class="default">'invalid'</code></td><td>Classe CSS ajoutée aux champs invalides.</td></tr>
                        <tr><td><code class="attr">validateErrorPlacement</code></td><td class="type">string</td><td><code class="default">'after'</code></td><td>Où afficher le message d'erreur ('after' l'élément ou 'tooltip').</td></tr>
                    </tbody>
                </table>
            </section>

             <section id="creation-modales">
                 <h2>Création de Modales</h2>

                 <h3 id="methode-create">Méthode <code>create(options)</code></h3>
                 <p>Cette méthode prépare une nouvelle modale mais ne l'affiche pas. Elle retourne l'ID unique de la modale créée, que vous utiliserez ensuite avec <code>open()</code>.</p>
                 <pre><code class="language-javascript">const modal = new ModalFlow();

// Créer une modale simple
const simpleModalId = modal.create({
    title: 'Titre de la Modale',
    content: '&lt;p&gt;Contenu HTML simple ici.&lt;/p&gt;'
    // ... autres options ...
});

// Plus tard...
modal.open(simpleModalId);</code></pre>

                 <h3 id="methode-createandopen">Méthode <code>createAndOpen(options)</code></h3>
                 <p>C'est la méthode la plus courante. Elle crée et ouvre la modale en une seule étape. Elle retourne également l'ID de la modale.</p>
                  <pre><code class="language-javascript">const modal = new ModalFlow();

// Créer et ouvrir directement
const modalId = modal.createAndOpen({
    title: 'Modale Instantanée',
    content: 'Affichée immédiatement !',
    width: '400px',
    resizable: true
});</code></pre>

                 <h3 id="options-creation">Options de Création (pour <code>create</code> et <code>createAndOpen</code>)</h3>
                 <p>Ces options permettent de définir le contenu et le comportement spécifique d'une modale. Elles surchargent les options globales définies dans le constructeur.</p>
                 <table>
                     <thead>
                         <tr><th>Option</th><th>Type</th><th>Description</th></tr>
                     </thead>
                     <tbody>
                         <tr><td><code class="attr">title</code></td><td class="type">string</td><td>Titre affiché dans l'en-tête par défaut. Ignoré si un header HTML est fourni dans `content`.</td></tr>
                         <tr><td><code class="attr">content</code></td><td class="type">string</td><td>Contenu HTML principal de la modale. Peut inclure un header (<code>.modal-flow-header</code>) et/ou un footer (<code>.modal__buttons</code>) personnalisés.</td></tr>
                         <tr><td><code class="attr">footer</code></td><td class="type">string</td><td>(Obsolète) Contenu HTML pour le pied de page. Préférez l'option <code>buttons</code> ou inclure une div <code>.modal__buttons</code> dans `content`.</td></tr>
                         <tr><td><code class="attr">url</code></td><td class="type">string</td><td>URL pour charger le contenu de la modale via une requête AJAX (POST).</td></tr>
                         <tr><td><code class="attr">params</code></td><td class="type">object</td><td>Objet de données à envoyer en tant que corps de la requête POST lors du chargement AJAX via `url`.</td></tr>
                         <tr><td><code class="attr">buttons</code></td><td class="type">Array&lt;object&gt;</td><td>Tableau pour définir les boutons du pied de page programmatiquement (voir section Footer/Boutons).</td></tr>
                         <tr><td><code class="attr">onConfirm</code></td><td class="type">function</td><td>Callback exécuté lorsque l'utilisateur clique sur le bouton "Confirmer" (si défini via l'option `buttons` ou par défaut).</td></tr>
                         <tr><td><code class="attr">onContentLoaded</code></td><td class="type">function</td><td>Callback exécuté après le chargement réussi du contenu via AJAX (`url`).</td></tr>
                         <tr><td><code class="attr">onError</code></td><td class="type">function</td><td>Callback exécuté en cas d'erreur lors du chargement AJAX. Reçoit l'objet erreur.</td></tr>
                         <tr><td><code class="attr">validate</code></td><td class="type">boolean</td><td>Active la validation pour un formulaire présent dans `content`.</td></tr>
                         <tr><td><code class="attr">draggable</code></td><td class="type">boolean</td><td>Active/désactive le déplacement pour cette modale.</td></tr>
                         <tr><td><code class="attr">resizable</code></td><td class="type">boolean</td><td>Active/désactive le redimensionnement pour cette modale.</td></tr>
                         <tr><td><code class="attr">width</code> / <code class="attr">height</code></td><td class="type">string</td><td>Dimensions spécifiques pour cette modale (ex: '600px', '70%').</td></tr>
                         <tr><td><code class="attr">showCloseButton</code></td><td class="type">boolean</td><td>Afficher/masquer le bouton (X) pour cette modale.</td></tr>
                         <tr><td><code class="attr">closeOnOverlayClick</code></td><td class="type">boolean</td><td>Permettre/empêcher la fermeture via clic sur l'overlay pour cette modale.</td></tr>
                         <tr><td><code class="attr">closeOnEscape</code></td><td class="type">boolean</td><td>Permettre/empêcher la fermeture via Échap pour cette modale.</td></tr>
                         <tr><td><code class="attr">preventClose</code></td><td class="type">boolean</td><td>(Interne/Avancé) Si true, empêche la fermeture via `closeModal()` sauf si `force` est utilisé.</td></tr>
                     </tbody>
                 </table>
            </section>

             <section id="gestion-modales">
                <h2>Gestion des Modales</h2>

                <h3 id="methode-open"><code>open(modalId)</code></h3>
                <p>Affiche une modale préalablement créée avec <code>create()</code>.</p>
                <pre><code>modal.open(simpleModalId); // 'simpleModalId' obtenu de modal.create()</code></pre>

                <h3 id="methode-close"><code>close(modalId)</code> / <code>closeModal(modalId, force)</code></h3>
                <p>Ferme la modale spécifiée. <code>closeModal()</code> offre une option <code>force</code> pour ignorer certaines configurations (comme <code>preventClose</code>).</p>
                 <pre><code>// Fermeture simple
modal.close('maModale-123');

// Fermeture forcée (utile dans certains callbacks)
modal.closeModal('maModale-123', true);</code></pre>

                <h3 id="methode-update"><code>update(modalId, options)</code></h3>
                <p>Met à jour le titre, le contenu ou le pied de page d'une modale déjà ouverte.</p>
                <pre><code>modal.update('maModale-123', {
    title: 'Titre Mis à Jour',
    content: 'Nouveau contenu chargé !',
    // Note: 'footer' ici remplacera tout le contenu du footer existant.
    // Il est souvent préférable de gérer les boutons via l'option 'buttons'.
    footer: '&lt;button onclick="modal.close('maModale-123')"&gt;OK&lt;/button&gt;'
});</code></pre>

                 <h3 id="methode-destroy"><code>destroy(modalId)</code></h3>
                 <p>Ferme et supprime complètement une modale du DOM et de la gestion interne de ModalFlow.</p>
                 <pre><code>modal.destroy('maModale-123');</code></pre>
            </section>

            <section id="personnalisation-affichage">
                <h2>Personnalisation de l'Affichage</h2>

                <h3 id="personnalisation-header">En-tête (Header)</h3>
                <p>Vous avez deux options pour l'en-tête :</p>
                <ol>
                    <li><strong>Header par défaut :</strong> Utilisez l'option <code>title: 'Mon Titre'</code> lors de la création. ModalFlow génère un header standard. Vous pouvez masquer le bouton de fermeture avec <code>showCloseButton: false</code>.</li>
                    <li><strong>Header HTML personnalisé :</strong> Incluez une <code>&lt;div class="modal-flow-header"&gt;...&lt;/div&gt;</code> directement dans votre option <code>content</code>. Dans ce cas, l'option <code>title</code> est ignorée. Le bouton de fermeture sera ajouté à votre header personnalisé si <code>showCloseButton: true</code> (valeur par défaut).</li>
                </ol>
                 <pre><code>// 1. Header par défaut
modal.createAndOpen({ title: 'Mon Titre Standard' });

// 2. Header HTML personnalisé dans le contenu
modal.createAndOpen({
    content: `
        &lt;div class="modal-flow-header" style="background: #eee;"&gt;
            &lt;i&gt;Mon Header HTML&lt;/i&gt;
            &lt;!-- Le bouton X sera ajouté ici si showCloseButton: true --&gt;
        &lt;/div&gt;
        &lt;div class="modal-flow-content"&gt;Contenu...&lt;/div&gt;
    `
    // title: 'Ce titre sera ignoré'
});</code></pre>

                <h3 id="personnalisation-footer">Pied de page (Footer) / Boutons</h3>
                <p>Comme pour l'en-tête, vous avez deux approches principales :</p>
                <ol>
                    <li><strong>Option <code>buttons</code> (Recommandé) :</strong> Fournissez un tableau d'objets lors de la création. C'est la méthode la plus propre et flexible.</li>
                    <li><strong>Footer HTML personnalisé :</strong> Incluez une <code>&lt;div class="modal__buttons"&gt;...&lt;/div&gt;</code> dans votre option <code>content</code>. ModalFlow déplacera ce contenu dans la zone de pied de page.</li>
                </ol>

                <h4>Option <code>buttons</code></h4>
                <p>Structure d'un objet bouton :</p>
                 <table>
                     <thead>
                         <tr><th>Propriété</th><th>Type</th><th>Description</th></tr>
                     </thead>
                     <tbody>
                         <tr><td><code class="attr">text</code></td><td class="type">string</td><td>Texte du bouton.</td></tr>
                         <tr><td><code class="attr">class</code></td><td class="type">string</td><td>Classe(s) CSS pour le bouton (ex: 'btn btn-primary').</td></tr>
                         <tr><td><code class="attr">onClick</code></td><td class="type">function</td><td>Fonction exécutée au clic. Doit retourner <code>true</code> pour fermer la modale après exécution, ou <code>false</code> pour la laisser ouverte.</td></tr>
                     </tbody>
                 </table>
                  <pre><code class="language-javascript">modal.createAndOpen({
    title: 'Confirmation',
    content: 'Êtes-vous sûr ?',
    buttons: [
        {
            text: 'Annuler',
            class: 'btn-secondary', // Classe CSS exemple
            onClick: () => {
                console.log('Annulé');
                return true; // Ferme la modale
            }
        },
        {
            text: 'Confirmer',
            class: 'btn-primary',
            onClick: () => {
                console.log('Confirmé, traitement...');
                // Simule une action
                setTimeout(() => {
                    console.log('Traitement terminé.');
                    modal.close('id_de_cette_modale'); // Fermeture manuelle possible
                }, 1000);
                return false; // Laisse la modale ouverte pendant le traitement
            }
        }
    ]
});</code></pre>

                <h4>Footer HTML</h4>
                 <pre><code>modal.createAndOpen({
    title: 'Avec Footer HTML',
    content: `
        &lt;div class="modal-flow-content"&gt;Contenu principal ici.&lt;/div&gt;
        &lt;!-- Cette div sera déplacée vers le pied de page --&gt;
        &lt;div class="modal__buttons"&gt;
            &lt;button type="button" class="btn-secondary" onclick="modal.close()"&gt;Fermer&lt;/button&gt;
            &lt;button type="button" class="btn-primary" onclick="alert('Action !')"&gt;Action&lt;/button&gt;
        &lt;/div&gt;
    `
});</code></pre>
                <div class="warning-block">L'approche avec l'option <code>buttons</code> est généralement préférée car elle sépare mieux la logique (JavaScript) de la présentation (HTML/contenu) et permet un contrôle plus fin du comportement de fermeture.</div>

                <h3 id="themes">Thèmes</h3>
                <p>Configurez le thème globalement (<code>theme: 'dark'</code> dans le constructeur) ou par modale (<code>modal.create({ theme: 'dark', ... })</code>). Le CSS de ModalFlow contient les styles pour les thèmes <code>light</code> et <code>dark</code>.</p>

                <h3 id="css">Personnalisation CSS</h3>
                <p>Surchargez les classes CSS suivantes pour adapter l'apparence :</p>
                <ul>
                    <li><code>.modal-flow-overlay</code>: Le fond semi-transparent.</li>
                    <li><code>.modal-flow</code>: Le conteneur principal de la modale.</li>
                    <li><code>.modal-flow.light-theme</code> / <code>.dark-theme</code>: Classes de thème.</li>
                    <li><code>.modal-flow-header</code>: L'en-tête.</li>
                    <li><code>.modal-flow-title</code>: Le titre dans l'en-tête.</li>
                    <li><code>.modal-flow-close</code>: Le bouton de fermeture (X).</li>
                    <li><code>.modal-flow-content</code>: La zone de contenu principal.</li>
                    <li><code>.modal-flow-footer</code>: Le pied de page contenant les boutons.</li>
                    <li><code>.modal-flow-loading</code>, <code>.modal-flow-spinner</code>: Indicateur de chargement AJAX.</li>
                    <li><code>.modal-flow-error</code>: Message d'erreur AJAX.</li>
                    <li><code>.resize-handle.se</code>, <code>.sw</code>, etc. : Poignées de redimensionnement.</li>
                    <li>Validation : <code>.invalid</code>, <code>.error-message</code> (classes par défaut).</li>
                </ul>
            </section>

            <section id="fonctionnalites-integrees">
                 <h2>Fonctionnalités Intégrées</h2>

                 <h3 id="drag-drop">Drag & Drop</h3>
                 <p>Activez le déplacement en passant <code>draggable: true</code> dans la configuration globale ou les options de création. Par défaut, l'en-tête (<code>.modal-flow-header</code>) sert de zone de préhension, mais cela peut être changé avec l'option <code>dragHandle</code>.</p>
                  <pre><code>const draggableModal = new ModalFlow({ draggable: true });
draggableModal.createAndOpen({ title: 'Déplacez-moi !' });</code></pre>

                 <h3 id="redimensionnement">Redimensionnement</h3>
                 <p>Activez le redimensionnement avec <code>resizable: true</code>. Vous pouvez contrôler les dimensions minimales (<code>minWidth</code>, <code>minHeight</code>), les poignées actives (<code>handles</code>), et si les proportions doivent être conservées (<code>keepAspectRatio</code>).</p>
                  <pre><code>const resizableModal = new ModalFlow({ resizable: true, minWidth: 400 });
resizableModal.createAndOpen({ title: 'Redimensionnez-moi', width: '500px', height: '300px'});</code></pre>

                 <h3 id="validation-formulaires">Validation de Formulaires</h3>
                 <p>Activez la validation pour une modale contenant un formulaire avec l'option <code>validate: true</code> (ou globalement avec <code>validateLive: true</code> dans le constructeur).</p>
                 <p>Ajoutez l'attribut <code>data-validate</code> aux champs <code>&lt;input&gt;</code>, <code>&lt;select&gt;</code>, <code>&lt;textarea&gt;</code>. Séparez plusieurs règles par un pipe (<code>|</code>).</p>
                 <pre><code>modal.createAndOpen({
    title: 'Formulaire Validé',
    content: `
        &lt;form&gt;
            &lt;div class="form-group"&gt;
                &lt;label&gt;Email:&lt;/label&gt;
                &lt;input type="email" name="email" data-validate="required|email"&gt;
                &lt;!-- Le message d'erreur s'affichera ici --&gt;
            &lt;/div&gt;
            &lt;div class="form-group"&gt;
                &lt;label&gt;Âge:&lt;/label&gt;
                &lt;input type="number" name="age" data-validate="required|min:18|max:99"&gt;
            &lt;/div&gt;
             &lt;div class="form-group"&gt;
                &lt;label&gt;Mot de passe:&lt;/label&gt;
                &lt;input type="password" name="password" data-validate="required|minLength:8"&gt;
            &lt;/div&gt;
             &lt;div class="form-group"&gt;
                &lt;label&gt;Confirmer Mdp:&lt;/label&gt;
                &lt;input type="password" name="confirm_password" data-validate="required|match:password"&gt;
                 &lt;!-- 'match:password' vérifie que la valeur est identique au champ ayant name="password" --&gt;
            &lt;/div&gt;
            &lt;button type="submit" class="btn-primary"&gt;Envoyer&lt;/button&gt;
        &lt;/form&gt;
    `,
    validate: true, // Active la validation pour cette modale
    buttons: [] // Pas besoin de boutons par défaut si le form a un submit
});</code></pre>
                <h4>Règles de Validation Disponibles (`data-validate`)</h4>
                 <table>
                    <thead><tr><th>Règle</th><th>Exemple</th><th>Description</th></tr></thead>
                    <tbody>
                        <tr><td><code>required</code></td><td><code>required</code></td><td>Le champ ne doit pas être vide.</td></tr>
                        <tr><td><code>email</code></td><td><code>email</code></td><td>Doit être une adresse email valide.</td></tr>
                        <tr><td><code>min:N</code></td><td><code>min:18</code></td><td>La valeur numérique doit être >= N.</td></tr>
                        <tr><td><code>max:N</code></td><td><code>max:100</code></td><td>La valeur numérique doit être <= N.</td></tr>
                        <tr><td><code>minLength:N</code></td><td><code>minLength:8</code></td><td>La longueur du texte doit être >= N.</td></tr>
                        <tr><td><code>maxLength:N</code></td><td><code>maxLength:255</code></td><td>La longueur du texte doit être <= N.</td></tr>
                        <tr><td><code>pattern:REGEX</code></td><td><code>pattern:^[A-Za-z]+$</code></td><td>La valeur doit correspondre à l'expression régulière.</td></tr>
                        <tr><td><code>match:fieldName</code></td><td><code>match:password</code></td><td>La valeur doit être identique à celle du champ ayant le `name` spécifié.</td></tr>
                    </tbody>
                 </table>
                <p>La validation se déclenche à la soumission du formulaire et/ou en temps réel si <code>validateLive: true</code>. Les erreurs sont affichées après le champ (par défaut) et la classe configurée (<code>invalid</code> par défaut) est ajoutée au champ invalide.</p>

                 <h3 id="chargement-ajax">Chargement AJAX</h3>
                 <p>Chargez le contenu d'une modale depuis une URL en utilisant les options <code>url</code> et <code>params</code>.</p>
                 <pre><code class="language-javascript">modal.createAndOpen({
    title: 'Détails Utilisateur',
    url: '/api/user/details', // URL à appeler en POST
    params: { userId: 42 }, // Données envoyées dans le corps de la requête
    onContentLoaded: () => {
        console.log('Contenu chargé et inséré dans la modale.');
        // Initialiser des scripts ou ajouter des écouteurs sur le nouveau contenu ici
    },
    onError: (error) => {
        console.error('Erreur AJAX:', error);
        // Afficher un message d'erreur personnalisé si besoin
    }
});</code></pre>
                 <p>Voir la section <a href="#reponses-serveur">Gestion Réponses Serveur</a> pour le format attendu des réponses.</p>
            </section>

             <section id="evenements">
                <h2>Événements</h2>
                <p>ModalFlow émet plusieurs événements auxquels vous pouvez vous abonner en utilisant la méthode <code>on(eventName, callback)</code>.</p>
                <pre><code class="language-javascript">const myModal = new ModalFlow();

myModal.on('open', (details) => {
    console.log(`Modale ouverte : ${details.modalId}`);
    // details contient { modalId, element }
});

myModal.on('close', (details) => {
    console.log(`Modale fermée : ${details.modalId}`);
    // details contient { modalId } (element n'est plus garanti d'exister)
});

myModal.on('formValid', (details) => {
    console.log('Formulaire valide soumis:', details.data);
    // details contient { modalId, form, data }
    // Vous pouvez envoyer les données `details.data` ici
    myModal.close(details.modalId); // Fermer la modale après soumission réussie
});

myModal.on('formInvalid', (details) => {
    console.warn('Tentative de soumission d'un formulaire invalide.');
    // details contient { modalId, form }
});

// Pour se désabonner : myModal.off('open', votreCallback);</code></pre>

                <h3>Liste des Événements Émis</h3>
                 <table>
                     <thead><tr><th>Événement</th><th>Données du Callback</th><th>Description</th></tr></thead>
                    <tbody>
                        <tr><td><code>create</code></td><td><code>{ modalId, element }</code></td><td>Déclenché après la création de l'élément DOM de la modale.</td></tr>
                        <tr><td><code>open</code></td><td><code>{ modalId, element }</code></td><td>Déclenché lorsque la modale devient visible.</td></tr>
                        <tr><td><code>close</code></td><td><code>{ modalId }</code></td><td>Déclenché après le début de l'animation de fermeture.</td></tr>
                        <tr><td><code>closeAll</code></td><td>-</td><td>Déclenché lors de la fermeture de toutes les modales.</td></tr>
                         <tr><td><code>update</code></td><td><code>{ modalId, element, options }</code></td><td>Déclenché après la mise à jour du contenu via <code>update()</code>.</td></tr>
                        <tr><td><code>destroy</code></td><td><code>{ modalId }</code></td><td>Déclenché après la suppression de la modale du DOM.</td></tr>
                        <tr><td><code>dragStart</code></td><td><code>{ modalId, x, y }</code></td><td>Début du déplacement.</td></tr>
                        <tr><td><code>drag</code></td><td><code>{ modalId, x, y }</code></td><td>Pendant le déplacement.</td></tr>
                        <tr><td><code>dragEnd</code></td><td><code>{ modalId, x, y }</code></td><td>Fin du déplacement.</td></tr>
                        <tr><td><code>resizeStart</code></td><td><code>{ modalId, width, height }</code></td><td>Début du redimensionnement.</td></tr>
                        <tr><td><code>resize</code></td><td><code>{ modalId, width, height }</code></td><td>Pendant le redimensionnement.</td></tr>
                         <tr><td><code>resizeEnd</code></td><td><code>{ modalId, width, height }</code></td><td>Fin du redimensionnement.</td></tr>
                        <tr><td><code>formValid</code></td><td><code>{ modalId, form, data }</code></td><td>Formulaire validé avec succès lors de la soumission. <code>data</code> est un objet des valeurs.</td></tr>
                         <tr><td><code>formInvalid</code></td><td><code>{ modalId, form }</code></td><td>Tentative de soumission d'un formulaire invalide.</td></tr>
                        <tr><td><code>contentLoaded</code></td><td><code>{ modalId, element }</code></td><td>Contenu AJAX chargé et inséré avec succès.</td></tr>
                         <tr><td><code>contentError</code></td><td><code>{ modalId, element, error }</code></td><td>Erreur lors du chargement du contenu AJAX.</td></tr>
                     </tbody>
                 </table>
            </section>

            <section id="reponses-serveur">
                <h2>Gestion Réponses Serveur (pour AJAX via <code>url</code>)</h2>
                <p>Lorsque vous utilisez l'option <code>url</code> pour charger le contenu, ModalFlow s'attend à recevoir soit du HTML direct, soit une réponse JSON en cas d'erreur côté serveur.</p>
                <table>
                     <thead><tr><th>Type de Réponse</th><th><code>Content-Type</code> HTTP</th><th>Format Attendu</th><th>Utilisation</th></tr></thead>
                    <tbody>
                        <tr>
                            <td>Succès</td>
                            <td><code>text/html</code></td>
                            <td>Chaîne de caractères contenant le code HTML à insérer dans <code>.modal-flow-content</code>.</td>
                            <td>Affichage normal du contenu de la modale.</td>
                        </tr>
                        <tr>
                             <td>Erreur</td>
                             <td><code>application/json</code></td>
                             <td>Objet JSON : <code>{ "erreur": 1, "msgError": "Votre message d'erreur ici" }</code></td>
                             <td>Permet à ModalFlow d'afficher une erreur claire à l'utilisateur au lieu d'essayer d'afficher une réponse d'erreur HTML/texte brute.</td>
                         </tr>
                     </tbody>
                 </table>
                  <div class="warning-block">
                    <strong>Important :</strong> Assurez-vous que votre backend renvoie le bon en-tête <code>Content-Type</code>. En cas d'erreur applicative (ex: élément non trouvé), renvoyez une réponse JSON structurée comme indiqué ci-dessus pour une meilleure expérience utilisateur.
                </div>
                 <h4>Exemple (PHP)</h4>
                 <pre><code>&lt;?php
// Récupérer les paramètres POST envoyés par ModalFlow
$userId = $_POST['userId'] ?? null;

try {
    if ($userId) {
        $userData = // Logique pour récupérer les données utilisateur...
        if ($userData) {
            // Succès : Renvoyer le HTML
            header('Content-Type: text/html; charset=utf-8');
            echo "&lt;h3&gt;Détails pour {$userData['name']}&lt;/h3&gt;&lt;p&gt;Email: {$userData['email']}&lt;/p&gt;";
        } else {
            throw new Exception("Utilisateur non trouvé.");
        }
    } else {
         throw new Exception("ID utilisateur manquant.");
    }

} catch (Exception $e) {
    // Erreur : Renvoyer JSON
    header('Content-Type: application/json; charset=utf-8');
    // Important : Ne pas envoyer de code d'erreur HTTP ici (ex: 404)
    // car fetch() lèverait une exception avant de lire le JSON.
    // La logique d'erreur est dans le JSON lui-même.
    // http_response_code(400); // NE PAS FAIRE CECI pour les erreurs applicatives
    echo json_encode([
        "erreur" => 1, // Indicateur d'erreur
        "msgError" => $e->getMessage() // Message d'erreur pour l'utilisateur
    ]);
    exit;
}
?&gt;</code></pre>
             </section>

             <section id="exemples-interactifs">
                 <h2>Exemples Interactifs</h2>
                 <div class="example">
                     <div class="example-preview">
                         <button class="btn-primary" onclick="interactiveShowSimple()">Simple</button>
                         <button class="btn-secondary" onclick="interactiveShowDraggable()">Déplaçable</button>
                         <button class="btn-secondary" onclick="interactiveShowResizable()">Redimensionnable</button>
                         <button class="btn-primary" onclick="interactiveShowValidation()">Validation</button>
                         <button class="btn-primary" onclick="interactiveShowAjax()">Contenu AJAX</button>
                         <button class="btn-secondary" onclick="interactiveShowWithButtons()">Avec Boutons JS</button>
                     </div>
                 </div>
             </section>

        </div>
    </div>

    <!-- Charger le script ModalFlow -->
    <script src="../src/modalFlow.js"></script>
    <script>
        // Initialisation pour les exemples interactifs
        const modalInstance = new ModalFlow({
            // Activer les fonctionnalités pour certains exemples
            draggable: true,
            resizable: true,
            validateLive: true,
            debug: false // Mettre à true pour voir les logs
        });

        // Exemple Simple
        function interactiveShowSimple() {
            modalInstance.createAndOpen({
                title: 'Modale Simple Interactive',
                content: '&lt;p&gt;Ceci est le contenu.&lt;/p&gt;&lt;p&gt;Vous pouvez la fermer avec la croix, Echap, ou en cliquant dehors.&lt;/p&gt;'
            });
        }

        // Exemple Déplaçable
        function interactiveShowDraggable() {
             modalInstance.createAndOpen({
                title: 'Modale Déplaçable',
                content: '&lt;p&gt;Cliquez sur l'en-tête et maintenez pour déplacer.&lt;/p&gt;',
                draggable: true, // Activation spécifique
                resizable: false // Désactivation spécifique
            });
        }

        // Exemple Redimensionnable
        function interactiveShowResizable() {
            modalInstance.createAndOpen({
                title: 'Modale Redimensionnable',
                content: '&lt;p&gt;Utilisez les poignées sur les bords pour redimensionner.&lt;/p&gt;',
                width: '500px',
                height: '300px',
                resizable: true, // Activation spécifique
                draggable: false // Désactivation spécifique
            });
        }

        // Exemple Validation
        function interactiveShowValidation() {
             modalInstance.createAndOpen({
                title: 'Formulaire avec Validation',
                content: `
                    &lt;form style="padding: 1rem;"&gt;
                        &lt;div class="form-group"&gt;
                            &lt;label for="val-name"&gt;Nom (requis, min 3):&lt;/label&gt;
                            &lt;input type="text" id="val-name" name="name" data-validate="required|minLength:3"&gt;
                        &lt;/div&gt;
                        &lt;div class="form-group"&gt;
                            &lt;label for="val-email"&gt;Email (requis, format email):&lt;/label&gt;
                            &lt;input type="email" id="val-email" name="email" data-validate="required|email"&gt;
                        &lt;/div&gt;
                        &lt;div class="form-group"&gt;
                            &lt;label for="val-age"&gt;Âge (optionnel, 18-65):&lt;/label&gt;
                            &lt;input type="number" id="val-age" name="age" data-validate="min:18|max:65"&gt;
                        &lt;/div&gt;
                        &lt;button type="submit" class="btn-primary" style="margin-top: 1rem;"&gt;Valider&lt;/button&gt;
                    &lt;/form&gt;
                `,
                validate: true,
                width: '450px',
                 buttons: [] // Vide car on utilise le submit du formulaire
            });
        }

        // Exemple AJAX
        function interactiveShowAjax() {
             modalInstance.createAndOpen({
                title: 'Chargement AJAX...',
                url: 'https://jsonplaceholder.typicode.com/posts/1', // API d'exemple
                params: { _comment: 'Paramètre envoyé' }, // Paramètre POST exemple
                onContentLoaded: () => {
                    console.log('Contenu de l'API jsonplaceholder chargé !');
                },
                onError: (err) => {
                    console.error("Erreur de chargement AJAX:", err);
                    // La modale affichera un message d'erreur par défaut
                },
                 // Nous devons redéfinir le contenu après le fetch, car l'API renvoie du JSON
                 // Normalement, votre API renverrait directement du HTML
                 content: '' // Sera remplacé
            });

            // Retravailler la réponse JSON en HTML (car l'API d'exemple renvoie JSON)
             modalInstance.on('contentLoaded', (details) => {
                const modalElement = document.getElementById(details.modalId);
                const contentDiv = modalElement.querySelector('.modal-flow-content');
                try {
                    // Le contenu brut est dans contentDiv.textContent
                    const data = JSON.parse(contentDiv.textContent);
                     modalInstance.update(details.modalId, {
                         title: data.title, // Met à jour le titre de la modale
                         content: `&lt;h4&gt;ID: ${data.id}&lt;/h4&gt;&lt;p&gt;${data.body}&lt;/p&gt;&lt;p&gt;&lt;i&gt;(Contenu de jsonplaceholder.typicode.com)&lt;/i&gt;&lt;/p&gt;`
                     });
                } catch (e) {
                    console.error("Erreur parsing JSON pour AJAX", e);
                     modalInstance.update(details.modalId, { content: 'Erreur: Impossible d'afficher les données.' });
                }
            });
        }

        // Exemple avec Boutons JS
        function interactiveShowWithButtons() {
            let counter = 0;
            const modalId = modalInstance.createAndOpen({
                title: 'Modale avec Boutons JS',
                content: '&lt;p&gt;Le compteur est à: &lt;span id="counter-span"&gt;0&lt;/span&gt;&lt;/p&gt;',
                buttons: [
                    {
                        text: 'Annuler',
                        class: 'btn-secondary',
                        onClick: () => {
                            console.log('Clic Annuler');
                            return true; // Ferme la modale
                        }
                    },
                    {
                        text: 'Incrémenter',
                        class: 'btn-primary',
                        onClick: () => {
                            counter++;
                            const span = document.getElementById('counter-span');
                            if(span) span.textContent = counter;
                            console.log('Compteur:', counter);
                            return false; // Laisse la modale ouverte
                        }
                    }
                ]
            });
        }

        // Écouteur d'événement exemple
        modalInstance.on('open', (details) => console.log('Événement OPEN déclenché pour', details.modalId));
        modalInstance.on('close', (details) => console.log('Événement CLOSE déclenché pour', details.modalId));

    </script>
</body>
</html>
